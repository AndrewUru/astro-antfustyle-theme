---
// src/components/CookieBanner.astro
---

<script>
  const showCookieBanner = () => {
    return (
      !document.cookie.includes('cookies-accepted=true') &&
      !document.cookie.includes('cookies-rejected=true')
    )
  }

  if (typeof window !== 'undefined') {
    window.addEventListener('DOMContentLoaded', () => {
      const banner = document.getElementById('cookie-banner')
      const configModal = document.getElementById('cookie-config')
      const acceptBtn = document.getElementById('accept-cookies')
      const rejectBtn = document.getElementById('reject-cookies')
      const configBtn = document.getElementById('config-cookies')
      const savePrefsBtn = document.getElementById('save-prefs')

      if (showCookieBanner()) {
        banner.style.display = 'block'
      }

      acceptBtn?.addEventListener('click', () => {
        document.cookie = 'cookies-accepted=true; path=/; max-age=31536000'
        banner.style.display = 'none'
      })

      rejectBtn?.addEventListener('click', () => {
        document.cookie = 'cookies-rejected=true; path=/; max-age=31536000'
        banner.style.display = 'none'
      })

      configBtn?.addEventListener('click', () => {
        configModal.style.display = 'block'
      })

      savePrefsBtn?.addEventListener('click', () => {
        const analytics = document.getElementById('analytics')?.checked
        const marketing = document.getElementById('marketing')?.checked

        document.cookie = `cookies-accepted=true; path=/; max-age=31536000`
        document.cookie = `allow-analytics=${analytics}; path=/; max-age=31536000`
        document.cookie = `allow-marketing=${marketing}; path=/; max-age=31536000`

        configModal.style.display = 'none'
        banner.style.display = 'none'
      })
    })
  }
</script>

<!-- Banner principal -->
<div
  id="cookie-banner"
  style="display:none"
  class="fixed bottom-4 left-4 right-4 bg-white text-black p-4 rounded shadow-lg text-sm max-w-xl mx-auto z-50"
>
  <p class="mb-2">
    Este sitio utiliza cookies para mejorar la experiencia del usuario.
  </p>
  <div class="flex flex-wrap gap-2">
    <button
      id="accept-cookies"
      class="bg-green-600 text-white px-3 py-1 rounded">Aceptar todas</button
    >
    <button id="config-cookies" class="bg-blue-600 text-white px-3 py-1 rounded"
      >Configurar</button
    >
    <button id="reject-cookies" class="bg-gray-400 text-black px-3 py-1 rounded"
      >Rechazar</button
    >
  </div>
</div>

<!-- Modal de configuración -->
<div
  id="cookie-config"
  style="display:none"
  class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"
>
  <div class="bg-white p-6 rounded max-w-md shadow-lg w-full">
    <h2 class="text-lg font-semibold mb-4">Preferencias de cookies</h2>
    <label class="block mb-2">
      <input type="checkbox" id="analytics" class="mr-2" /> Cookies analíticas
    </label>
    <label class="block mb-4">
      <input type="checkbox" id="marketing" class="mr-2" /> Cookies de marketing
    </label>
    <div class="flex gap-2 justify-end">
      <button id="save-prefs" class="bg-blue-600 text-white px-3 py-1 rounded"
        >Guardar preferencias</button
      >
    </div>
  </div>
</div>
