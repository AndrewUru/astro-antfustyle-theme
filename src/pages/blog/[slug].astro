---
import { getCollection } from 'astro:content'

import BaseLayout from '~/layouts/BaseLayout.astro'
import StandardLayout from '~/layouts/StandardLayout.astro'
import Toc from '~/components/toc/Toc.astro'
import ShareLink from '~/components/widgets/ShareLink.astro'

import config from '~/config'

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    return import.meta.env.PROD ? data.draft !== true : true
  })

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }))
}

const { post } = Astro.props
const { data: frontmatter } = post
const { Content, headings } = await post.render()

const { share, toc } = config.features
---

<BaseLayout
  title={frontmatter.title}
  description={frontmatter.description}
  ogImage={frontmatter.ogImage}
>
  {Array.isArray(toc) && toc[0] && frontmatter.toc && <Toc {headings} />}
  <StandardLayout {post}>
    <Content />
  </StandardLayout>
  {
    Array.isArray(share) && share[0] && frontmatter.share && (
      <ShareLink slot="share" config={share[1]} />
    )
  }
</BaseLayout>
